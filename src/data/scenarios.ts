// What-If Scenarios - Predefined financial scenarios for learning and exploration
// Educational scenarios to help users understand different investment approaches

import type { ReturnMode } from '../utils/random-returns'
import type { WithdrawalStrategy } from '../../helpers/withdrawal'

export interface FinancialScenario {
  id: string
  name: string
  description: string
  category: 'conservative' | 'balanced' | 'aggressive' | 'special'
  icon: string

  // Scenario configuration
  config: {
    // Time range
    startYear: number
    retirementYear: number

    // Savings plan
    monthlyContribution: number
    initialInvestment?: number

    // Return configuration
    returnMode: ReturnMode
    expectedReturn: number
    volatility?: number // For random return mode

    // Tax configuration
    steuerlast?: number
    teilfreistellungsquote?: number
    freibetrag?: number

    // Withdrawal strategy
    withdrawalStrategy?: WithdrawalStrategy
    withdrawalRate?: number

    // Special characteristics
    ter?: number
    inflationRate?: number
  }

  // Educational content
  learningPoints: string[]
  risks: string[]
  suitableFor: string[]
}

export const predefinedScenarios: FinancialScenario[] = [
  // Conservative Scenarios
  {
    id: 'conservative-beginner',
    name: 'üõ°Ô∏è Vorsichtiger Einsteiger',
    description: 'Konservative Strategie mit geringem Risiko f√ºr Anf√§nger. Fokus auf Kapitalerhalt mit moderatem Wachstum.',
    category: 'conservative',
    icon: 'üõ°Ô∏è',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 30,
      monthlyContribution: 300,
      initialInvestment: 5000,
      returnMode: 'fixed',
      expectedReturn: 3.5,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: '3prozent',
      ter: 0.2,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Niedriges Risiko durch konservative Anlagestrategie',
      'Geringe Kosten (TER 0,2%) durch kosteng√ºnstige ETFs',
      'Vorhersehbare Rendite durch feste 3,5% p.a.',
      'Langfristiger Verm√∂gensaufbau √ºber 30 Jahre',
    ],
    risks: [
      'Geringe Rendite kann Inflation nur leicht √ºbertreffen',
      'Bei h√∂herer Inflation Kaufkraftverlust m√∂glich',
      'Opportunit√§tskosten gegen√ºber aggressiveren Strategien',
    ],
    suitableFor: [
      'B√∂rsen-Einsteiger ohne Erfahrung',
      'Sicherheitsorientierte Anleger',
      'Personen mit geringer Risikotoleranz',
    ],
  },
  {
    id: 'conservative-retiree',
    name: 'üèñÔ∏è Ruhestand-Sicherheit',
    description: 'Kapitalerhalt im Ruhestand mit stabilen Entnahmen. Minimales Risiko f√ºr bereits Rentner.',
    category: 'conservative',
    icon: 'üèñÔ∏è',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear(),
      monthlyContribution: 0,
      initialInvestment: 400000,
      returnMode: 'fixed',
      expectedReturn: 2.5,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: 'kapitalerhalt',
      ter: 0.15,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Kapitalerhalt-Strategie sichert realen Verm√∂genswert',
      'Stabile, inflationsgesch√ºtzte Entnahmen',
      'Sehr niedrige Volatilit√§t durch konservative Anlage',
      'Verm√∂gen bleibt f√ºr Erben erhalten',
    ],
    risks: [
      'Sehr geringe Entnahmen bei niedriger Rendite',
      'Potenzial f√ºr h√∂here Entnahmen wird nicht genutzt',
      'Sensibel gegen√ºber steigenden Inflationsraten',
    ],
    suitableFor: [
      'Rentner mit Fokus auf Kapitalerhalt',
      'Personen mit ausreichend anderen Einkommensquellen',
      'Anleger, die Verm√∂gen vererben m√∂chten',
    ],
  },

  // Balanced Scenarios
  {
    id: 'balanced-standard',
    name: '‚öñÔ∏è Ausgewogener Verm√∂gensaufbau',
    description: 'Klassische 70/30-Strategie mit ausgewogenem Risiko-Rendite-Profil. Bew√§hrte Langzeitstrategie.',
    category: 'balanced',
    icon: '‚öñÔ∏è',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 30,
      monthlyContribution: 500,
      initialInvestment: 10000,
      returnMode: 'random',
      expectedReturn: 6.0,
      volatility: 12,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: '4prozent',
      ter: 0.25,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Ausgewogenes Verh√§ltnis zwischen Rendite und Risiko',
      'Historisch bew√§hrte 4%-Entnahme-Regel',
      'Volatilit√§t zeigt realistische Marktschwankungen',
      'Langfristig attraktive Rendite nach Kosten',
    ],
    risks: [
      'Volatilit√§t von 12% bedeutet gr√∂√üere Schwankungen',
      'Sequenzrisiko in ersten Entnahmejahren',
      'Rendite nicht garantiert, nur historischer Durchschnitt',
    ],
    suitableFor: [
      'Langfristig orientierte Anleger (20+ Jahre)',
      'Personen mit moderater Risikotoleranz',
      'Anleger, die Schwankungen aushalten k√∂nnen',
    ],
  },
  {
    id: 'balanced-couple',
    name: 'üë´ Altersvorsorge f√ºr Paare',
    description: 'Gemeinsame Altersvorsorge mit erh√∂htem Sparerpauschbetrag. Optimiert f√ºr Ehepaare.',
    category: 'balanced',
    icon: 'üë´',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 25,
      monthlyContribution: 800,
      initialInvestment: 20000,
      returnMode: 'random',
      expectedReturn: 6.5,
      volatility: 14,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 4000, // Doubled for couples
      withdrawalStrategy: '4prozent',
      ter: 0.3,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Doppelter Sparerpauschbetrag (4.000‚Ç¨) f√ºr Paare',
      'H√∂here monatliche Sparrate durch gemeinsames Einkommen',
      'Gemeinsame Lebenserwartung ber√ºcksichtigen',
      'Steueroptimierung durch Zusammenveranlagung',
    ],
    risks: [
      'Abh√§ngigkeit von beiden Einkommen',
      'L√§ngere Lebensspanne erfordert mehr Kapital',
      'Komplexit√§t bei unterschiedlichen Renteneintritten',
    ],
    suitableFor: [
      'Verheiratete Paare oder eingetragene Partnerschaften',
      'Gemeinsame Finanzplanung mit beiden Partnern',
      'Langfristige, stabile Beziehungen',
    ],
  },

  // Aggressive Scenarios
  {
    id: 'aggressive-growth',
    name: 'üöÄ Maximales Wachstum',
    description: '100% Aktien-Strategie f√ºr maximales Wachstumspotenzial. Nur f√ºr langfristige, risikotolerante Anleger.',
    category: 'aggressive',
    icon: 'üöÄ',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 35,
      monthlyContribution: 1000,
      initialInvestment: 15000,
      returnMode: 'random',
      expectedReturn: 8.0,
      volatility: 18,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: 'dynamisch',
      ter: 0.2,
      inflationRate: 2.0,
    },
    learningPoints: [
      'H√∂chste erwartete Rendite durch 100% Aktienanteil',
      'Langfristiger Anlagehorizont nutzt Zinseszins-Effekt',
      'Dynamische Entnahmestrategie passt sich Markt an',
      'Teilfreistellung reduziert Steuerlast auf Aktienfonds',
    ],
    risks: [
      'Sehr hohe Volatilit√§t (18%) f√ºhrt zu gro√üen Schwankungen',
      'Potenzielle Verluste in Krisenzeiten bis -50%',
      'Psychologische Belastung bei starken Kursr√ºckg√§ngen',
      'Sequenzrisiko besonders ausgepr√§gt',
    ],
    suitableFor: [
      'Junge Anleger mit 30+ Jahren Anlagehorizont',
      'Hohe Risikotoleranz und finanzielle Stabilit√§t',
      'Personen ohne kurzfristigen Kapitalbedarf',
    ],
  },
  {
    id: 'aggressive-early-retirement',
    name: 'üíº Fr√ºher Ruhestand (FIRE)',
    description: 'Financial Independence, Retire Early - Aggressive Sparstrategie f√ºr fr√ºhe finanzielle Unabh√§ngigkeit.',
    category: 'aggressive',
    icon: 'üíº',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 15,
      monthlyContribution: 2500,
      initialInvestment: 50000,
      returnMode: 'random',
      expectedReturn: 7.5,
      volatility: 16,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: '3prozent',
      ter: 0.15,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Sehr hohe Sparquote (50-70% des Einkommens)',
      'Kurze Ansparphase erfordert aggressive Strategie',
      'Konservative 3%-Entnahme f√ºr lange Rentendauer',
      'Fr√ºhe finanzielle Unabh√§ngigkeit ab 40-45 Jahren',
    ],
    risks: [
      'Extrem hohe Sparquote schr√§nkt Lebensqualit√§t ein',
      'Lange Entnahmephase (40-50 Jahre) ist anspruchsvoll',
      'Gesundheitskosten in jungen Jahren ohne Arbeitgeber',
      'Inflation √ºber lange Zeitr√§ume schwer vorhersagbar',
    ],
    suitableFor: [
      'Hochverdiener mit niedriger Konsumneigung',
      'Personen mit starkem Wunsch nach fr√ºher Unabh√§ngigkeit',
      'Disziplinierte Sparer mit klarem Ziel',
    ],
  },

  // Special Scenarios
  {
    id: 'special-inheritance',
    name: 'üéÅ Erbschaft investieren',
    description: 'Einmalanlage einer Erbschaft mit langfristigem Anlagehorizont. Optimale Nutzung von Einmalkapital.',
    category: 'special',
    icon: 'üéÅ',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 20,
      monthlyContribution: 200, // Small regular contribution
      initialInvestment: 100000, // Large inheritance
      returnMode: 'random',
      expectedReturn: 6.5,
      volatility: 13,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: '4prozent',
      ter: 0.25,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Gro√üe Einmalanlage profitiert sofort vom Zinseszins',
      'Zus√§tzliche monatliche Sparrate verst√§rkt Effekt',
      'Langfristiger Anlagehorizont gl√§ttet Volatilit√§t',
      'Erbschaftsteuer bereits abgezogen (Netto-Betrag)',
    ],
    risks: [
      'Timing-Risiko bei Einmalanlage (Markt-Hochpunkt)',
      'Versuchung, gro√üe Summe auszugeben statt anzulegen',
      'Emotionale Bindung an Erbschaft kann Entscheidungen beeinflussen',
    ],
    suitableFor: [
      'Empf√§nger gr√∂√üerer Erbschaften oder Schenkungen',
      'Personen mit langfristigem Anlagehorizont',
      'Anleger, die diszipliniert mit gro√üen Summen umgehen k√∂nnen',
    ],
  },
  {
    id: 'special-career-break',
    name: 'üéì Sabbatical-Planung',
    description: 'Vorbereitung auf eine Auszeit mit gezieltem Verm√∂gensaufbau. Finanzielle Freiheit f√ºr tempor√§re Auszeit.',
    category: 'special',
    icon: 'üéì',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 5, // Short-term goal
      monthlyContribution: 1200,
      initialInvestment: 10000,
      returnMode: 'fixed',
      expectedReturn: 4.0, // Conservative for short timeframe
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: 'monatlich_fest',
      ter: 0.2,
      inflationRate: 2.0,
    },
    learningPoints: [
      'Kurzer Anlagehorizont erfordert konservative Strategie',
      'Feste Rendite f√ºr planbare Zielerreichung',
      'Hohe Sparquote f√ºr schnellen Verm√∂gensaufbau',
      'Monatliche Entnahmen w√§hrend Sabbatical-Phase',
    ],
    risks: [
      'Kurzer Zeitraum l√§sst wenig Puffer f√ºr Marktvolatilit√§t',
      'Feste Kosten w√§hrend Auszeit k√∂nnten steigen',
      'Wiedereinstieg in Arbeitsleben nicht garantiert',
      'Gehaltssteigerungen w√§hrend Pause verpasst',
    ],
    suitableFor: [
      'Personen, die eine tempor√§re Auszeit planen',
      'Sabbatical, Weltreise oder Weiterbildung',
      'Mittelfristige Finanzplanung (3-7 Jahre)',
    ],
  },
  {
    id: 'special-child-education',
    name: 'üë∂ Ausbildung f√ºr Kinder',
    description: 'Langfristiger Verm√∂gensaufbau f√ºr die Ausbildung der Kinder. Bildungssparen mit Horizont bis Vollj√§hrigkeit.',
    category: 'special',
    icon: 'üë∂',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 18, // Until child is 18
      monthlyContribution: 250,
      initialInvestment: 5000,
      returnMode: 'random',
      expectedReturn: 6.0,
      volatility: 12,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: 'monatlich_fest',
      ter: 0.3,
      inflationRate: 2.5, // Higher education inflation
    },
    learningPoints: [
      'Langer Anlagehorizont erm√∂glicht aktienorientierte Strategie',
      'Fr√ºher Start maximiert Zinseszins-Effekt',
      'Flexibilit√§t durch ETF-Investment (kein Versicherungsprodukt)',
      'Kapital steht f√ºr Studium, Ausbildung oder Start ins Berufsleben bereit',
    ],
    risks: [
      'Bildungsinflation oft h√∂her als allgemeine Inflation',
      'Unsicherheit √ºber tats√§chlichen Kapitalbedarf',
      'Marktvolatilit√§t zum Auszahlungszeitpunkt',
      'Steuerliche Behandlung bei √úbertragung auf Kind',
    ],
    suitableFor: [
      'Eltern oder Gro√üeltern, die f√ºr Kinder vorsorgen',
      'Langfristige Bildungsplanung (10-20 Jahre)',
      'Alternative zu klassischen Ausbildungsversicherungen',
    ],
  },
  {
    id: 'special-self-employed',
    name: 'üè¢ Selbstst√§ndigen-Vorsorge',
    description: 'Altersvorsorge f√ºr Selbstst√§ndige ohne Rentenanspruch. Eigenverantwortliche Ruhestandsplanung.',
    category: 'special',
    icon: 'üè¢',
    config: {
      startYear: new Date().getFullYear(),
      retirementYear: new Date().getFullYear() + 30,
      monthlyContribution: 1500, // Higher to compensate for no pension
      initialInvestment: 25000,
      returnMode: 'random',
      expectedReturn: 7.0,
      volatility: 15,
      steuerlast: 26.375,
      teilfreistellungsquote: 30,
      freibetrag: 2000,
      withdrawalStrategy: 'bucket_strategie',
      ter: 0.25,
      inflationRate: 2.0,
    },
    learningPoints: [
      'H√∂here Sparrate kompensiert fehlende gesetzliche Rente',
      'Bucket-Strategie bietet Sicherheit bei Marktvolatilit√§t',
      'Eigenverantwortliche Altersvorsorge ohne Arbeitgeberanteil',
      'Flexibilit√§t bei schwankenden Einkommen m√∂glich',
    ],
    risks: [
      'Keine gesetzliche Absicherung bei Berufsunf√§higkeit',
      'Schwankende Einkommen erschweren konstantes Sparen',
      'Keine Arbeitgeberanteile zur Rentenversicherung',
      'Eigenverantwortung erfordert Disziplin und Wissen',
    ],
    suitableFor: [
      'Selbstst√§ndige ohne Pflichtversicherung',
      'Freiberufler mit unregelm√§√üigem Einkommen',
      'Personen, die eigenverantwortlich vorsorgen m√∂chten',
    ],
  },
]

// Helper function to get scenario by ID
export function getScenarioById(id: string): FinancialScenario | undefined {
  return predefinedScenarios.find(scenario => scenario.id === id)
}

// Get scenarios by category
export function getScenariosByCategory(category: FinancialScenario['category']): FinancialScenario[] {
  return predefinedScenarios.filter(scenario => scenario.category === category)
}

// Get all categories
export function getScenarioCategories(): Array<{ id: FinancialScenario['category'], name: string, icon: string }> {
  return [
    { id: 'conservative', name: 'Konservativ', icon: 'üõ°Ô∏è' },
    { id: 'balanced', name: 'Ausgewogen', icon: '‚öñÔ∏è' },
    { id: 'aggressive', name: 'Wachstumsorientiert', icon: 'üöÄ' },
    { id: 'special', name: 'Spezielle Situationen', icon: '‚≠ê' },
  ]
}

// Search scenarios by name or description
export function searchScenarios(query: string): FinancialScenario[] {
  const lowerQuery = query.toLowerCase()
  return predefinedScenarios.filter(
    scenario =>
      scenario.name.toLowerCase().includes(lowerQuery)
      || scenario.description.toLowerCase().includes(lowerQuery)
      || scenario.learningPoints.some(point => point.toLowerCase().includes(lowerQuery))
      || scenario.suitableFor.some(suitable => suitable.toLowerCase().includes(lowerQuery)),
  )
}
